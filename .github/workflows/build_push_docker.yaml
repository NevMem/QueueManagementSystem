name: build_push_docker

on: [ push ]

jobs:
  build_push:
    name: "Build and push docker of push microservice"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: "Install java"
        run: apt update && apt-get install -y --allow-downgrades --allow-remove-essential --allow-change-held-packages  openjdk-8-jdk
      - name: "Login to registry"
        uses: docker/login-action@v1
        with:
          registry: cr.yandex
          username: json_key
          password: ${{ secrets.REGISTRY_SECRET }}
      - name: "Build docker"
        run: cd push/docker/ && ./build.sh
      - name: "Push"
        run: docker push cr.yandex/crp59su1rb652ia7ojk8/push:$(git rev-parse HEAD)
